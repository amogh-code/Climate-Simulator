<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Simulator</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 0;
            transition: background-color 0.5s, color 0.5s;
        }
        .container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
        }
        .dark-mode {
            background-color: #2c2c2c;
            color: #e0e0e0;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .graph-container {
            margin-top: 30px;
            border: 1px solid #ccc;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease-in-out;
        }
        .graph-container:hover {
            transform: scale(1.02);
        }
        button {
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }
        .menu-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            padding: 15px;
            border-radius: 8px;
            transition: opacity 0.3s;
        }
        .dark-mode .menu-content {
            background-color: #444;
        }
        .menu-content select, .menu-content button {
            margin-top: 10px;
        }
        input[type="range"] {
            width: 60%;
            margin-left: 10px;
        }
        #dateTime {
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div id="dateTime"></div>
            <div id="settings">
                <span id="deviceMenu" onclick="toggleMenu()">Settings</span>
                <div class="menu-content" id="menuContent">
                    <label for="deviceSelector">Select Device:</label>
                    <select id="deviceSelector" onchange="updateLayout()">
                        <option value="desktop">Desktop</option>
                        <option value="mobile">Mobile</option>
                    </select>
                    <button id="toggleButton" onclick="toggleDarkMode()">Toggle Dark Mode</button>
                </div>
            </div>
        </header>

        <h3 style="font-size: 12px; text-align: center;">|| Jai Guru Dev ||</h3>
        <h1 style="text-align: center;">Anweshna 2025</h1>
        <h3 style="text-align: center;">Done by Advaith, Hariprasad, and Amogh from Class 12 A SSRVM North Bangalore</h3>
        <h2 style="text-align: center;">Climate Simulator</h2>

        <form id="inputForm">
            <div class="slider-container">
                <label class="slider-label">Ocean Heat Absorption Coefficient (A_OCEAN): 
                    <input type="range" min="0" max="1" value="0.2" step="0.01" id="A_OCEAN" oninput="updateValue('A_OCEAN')">
                    <span id="A_OCEAN_value">0.20</span>
                </label>
                <label class="slider-label">Land Heat Absorption Coefficient (A_LAND): 
                    <input type="range" min="0" max="1" value="0.3" step="0.01" id="A_LAND" oninput="updateValue('A_LAND')">
                    <span id="A_LAND_value">0.30</span>
                </label>
                <label class="slider-label">Sea Ice Heat Absorption Coefficient (A_ICE): 
                    <input type="range" min="0" max="1" value="0.1" step="0.01" id="A_ICE" oninput="updateValue('A_ICE')">
                    <span id="A_ICE_value">0.10</span>
                </label>
                <label class="slider-label">Ice Melt Rate: 
                    <input type="range" min="0" max="0.1" value="0.05" step="0.001" id="ICE_MELT_RATE" oninput="updateValue('ICE_MELT_RATE')">
                    <span id="ICE_MELT_RATE_value">0.050</span>
                </label>
                <label class="slider-label">Time Steps (Years): 
                    <input type="range" min="10" max="200" value="100" id="TIME_STEPS" oninput="updateValue('TIME_STEPS')">
                    <span id="TIME_STEPS_value">100</span>
                </label>
                <label class="slider-label">Wind Magnitude (m/s): 
                    <input type="range" min="0" max="20" value="5" step="0.1" id="wind_magnitude" oninput="updateValue('wind_magnitude')">
                    <span id="wind_magnitude_value">5.0</span>
                </label>
                <label class="slider-label">Greenhouse Gases (normalized): 
                    <input type="range" min="0.5" max="2" value="1" step="0.01" id="greenhouse_gases" oninput="updateValue('greenhouse_gases')">
                    <span id="greenhouse_gases_value">1.00</span>
                </label>
            </div>
            <button type="submit">Generate Graphs</button>
        </form>

        <div class="graph-container" id="atmosphereTemp"></div>
        <div class="graph-container" id="oceanTemp"></div>
        <div class="graph-container" id="landTemp"></div>
        <div class="graph-container" id="iceVolume"></div>
    </div>

    <script>
        function updateDateTime() {
            const now = new Date();
            document.getElementById('dateTime').innerText = now.toLocaleString();
        }

        function updateValue(sliderId) {
            const sliderValue = document.getElementById(sliderId).value;
            document.getElementById(sliderId + '_value').innerText = parseFloat(sliderValue).toFixed(3);
        }

        function toggleMenu() {
            const menuContent = document.getElementById("menuContent");
            anime({
                targets: menuContent,
                opacity: menuContent.style.display === "block" ? [1, 0] : [0, 1],
                duration: 300,
                easing: 'easeInOutQuad',
                begin: function(anim) {
                    if (menuContent.style.display !== "block") {
                        menuContent.style.display = "block";
                    }
                },
                complete: function(anim) {
                    if (menuContent.style.opacity === '0') {
                        menuContent.style.display = "none";
                    }
                }
            });
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const button = document.getElementById('toggleButton');
            button.innerText = document.body.classList.contains('dark-mode') ? 'Toggle Light Mode' : 'Toggle Dark Mode';
            
            // Animate the transition
            anime({
                targets: 'body',
                backgroundColor: document.body.classList.contains('dark-mode') ? '#2c2c2c' : '#f0f0f0',
                color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333',
                duration: 500,
                easing: 'easeInOutQuad'
            });
        }

        function updateLayout() {
            const selectedDevice = document.getElementById('deviceSelector').value;
            const fontSize = selectedDevice === 'mobile' ? '14px' : '16px';
            const graphWidth = selectedDevice === 'mobile' ? '95%' : '80%';
            
            anime({
                targets: 'body',
                fontSize: fontSize,
                duration: 500,
                easing: 'easeInOutQuad'
            });

            anime({
                targets: '.graph-container',
                width: graphWidth,
                duration: 500,
                easing: 'easeInOutQuad'
            });
        }

        function generateGraphs(event) {
            event.preventDefault();

            const A_OCEAN = parseFloat(document.getElementById('A_OCEAN').value);
            const A_LAND = parseFloat(document.getElementById('A_LAND').value);
            const A_ICE = parseFloat(document.getElementById('A_ICE').value);
            const ICE_MELT_RATE = parseFloat(document.getElementById('ICE_MELT_RATE').value);
            const TIME_STEPS = parseInt(document.getElementById('TIME_STEPS').value);
            const wind_magnitude = parseFloat(document.getElementById('wind_magnitude').value);
            const greenhouse_gases = parseFloat(document.getElementById('greenhouse_gases').value);

            let atmosphere_temps = [];
            let ocean_temps = [];
            let land_temps = [];
            let sea_ice_volumes = [];

            let atmosphere_temp = 15;
            let ocean_temp = 10;
            let land_temp = 12;
            let sea_ice_volume = 100;

            const C_ATMOSPHERE = 1;
            const C_OCEAN = 10;
            const C_LAND = 5;

            for (let i = 0; i < TIME_STEPS; i++) {
                // Heat transfer calculations
                let heat_atmosphere_to_ocean = A_OCEAN * (atmosphere_temp - ocean_temp) / C_OCEAN;
                let heat_land_to_ocean = A_LAND * (land_temp - ocean_temp) / C_OCEAN;
                let heat_ocean_to_land = A_LAND * (ocean_temp - land_temp) / C_LAND;

                // Temperature updates
                atmosphere_temp += -heat_atmosphere_to_ocean * C_ATMOSPHERE + greenhouse_gases * 0.1;
                ocean_temp += heat_atmosphere_to_ocean + heat_land_to_ocean - A_ICE * sea_ice_volume / 1000;
                land_temp += heat_ocean_to_land + wind_magnitude * 0.01;

                // Sea ice volume update
                sea_ice_volume = Math.max(0, sea_ice_volume - ICE_MELT_RATE * (ocean_temp - 0));

                atmosphere_temps.push(atmosphere_temp);
                ocean_temps.push(ocean_temp);
                land_temps.push(land_temp);
                sea_ice_volumes.push(sea_ice_volume);
            }

            const plotGraphs = (elementId, data, title, yaxisTitle, color) => {
                Plotly.newPlot(elementId, [{
                    x: Array.from({ length: TIME_STEPS }, (_, i) => i + 1),
                    y: data,
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: color, width: 3 }
                }], {
                    title: title,
                    xaxis: { title: 'Time (Years)' },
                    yaxis: { title: yaxisTitle },
                    plot_bgcolor: 'rgba(240,240,240,0.8)',
                    paper_bgcolor: 'rgba(255,255,255,0.8)',
                    font: { color: 'black' },
                    transition: {
                        duration: 500,
                        easing: 'cubic-in-out'
                    }
                });
            };

            plotGraphs('atmosphereTemp', atmosphere_temps, 'Atmospheric Temperature Over Time', 'Temperature (°C)', 'red');
            plotGraphs('oceanTemp', ocean_temps, 'Ocean Temperature Over Time', 'Temperature (°C)', 'blue');
            plotGraphs('landTemp', land_temps, 'Land Temperature Over Time', 'Temperature (°C)', 'green');
            plotGraphs('iceVolume', sea_ice_volumes, 'Sea Ice Volume Over Time', 'Volume (Million km³)', 'cyan');

            // Animate the appearance of graphs
            anime({
                targets: '.graph-container',
                opacity: [0, 1],
                translateY: [50, 0],
                duration: 1000,
                delay: anime.stagger(200),
                easing: 'easeOutExpo'
            });
        }

        document.getElementById('inputForm').addEventListener('submit', generateGraphs);
        setInterval(updateDateTime, 1000);
        updateLayout();

        // Initial animations
        anime({
            targets: '.container',
            opacity: [0, 1],
            translateY: [50, 0],
            duration: 1000,
            easing: 'easeOutExpo'
        });
    </script>
</body>
</html>
